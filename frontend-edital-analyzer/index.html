<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analisador de Editais - IA</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-content {
            padding: 40px;
        }

        .input-section {
            margin-bottom: 40px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        input, textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
        }

        textarea {
            min-height: 200px;
            resize: vertical;
        }

        .btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results {
            display: none;
            margin-top: 40px;
        }

        .result-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            border-left: 5px solid #3498db;
        }

        .result-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            font-weight: 600;
            color: #2c3e50;
        }

        .result-value {
            color: #7f8c8d;
        }

        .status-success {
            color: #27ae60;
            font-weight: 600;
        }

        .status-error {
            color: #e74c3c;
            font-weight: 600;
        }

        .sample-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .btn-sample {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn-sample:hover {
            transform: translateY(-1px);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #3498db;
        }

        .stat-label {
            color: #7f8c8d;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç Analisador de Editais - IA</h1>
            <p>Sistema inteligente de an√°lise de editais de concursos p√∫blicos</p>
        </div>

        <div class="main-content">
            <div class="input-section">
                <h2>üìù An√°lise de Edital</h2>
                
                <div class="sample-buttons">
                    <button class="btn-sample" onclick="loadSampleEdital()">üìÑ Carregar Exemplo</button>
                    <button class="btn-sample" onclick="clearForm()">üóëÔ∏è Limpar</button>
                </div>

                <div class="input-group">
                    <label for="urlEdital">üîó URL do Edital (opcional):</label>
                    <input type="url" id="urlEdital" placeholder="https://exemplo.com/edital.pdf">
                </div>

                <div class="input-group">
                    <label for="banca">üèõÔ∏è Banca Organizadora (opcional):</label>
                    <input type="text" id="banca" placeholder="CESPE, FGV, FCC, etc.">
                </div>

                <div class="input-group">
                    <label for="conteudoEdital">üìã Conte√∫do do Edital:</label>
                    <textarea id="conteudoEdital" placeholder="Cole aqui o conte√∫do do edital que deseja analisar..."></textarea>
                </div>

                <button class="btn" onclick="analisarEdital()" id="btnAnalisar">
                    üöÄ Analisar Edital
                </button>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Analisando edital com IA...</p>
            </div>

            <div class="results" id="results">
                <h2>üìä Resultados da An√°lise</h2>
                <div id="resultsContent"></div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8002';

        async function analisarEdital() {
            const conteudo = document.getElementById('conteudoEdital').value.trim();
            const urlEdital = document.getElementById('urlEdital').value.trim();
            const banca = document.getElementById('banca').value.trim();

            if (!conteudo) {
                alert('Por favor, insira o conte√∫do do edital para an√°lise.');
                return;
            }

            if (conteudo.length < 100) {
                alert('O conte√∫do do edital deve ter pelo menos 100 caracteres.');
                return;
            }

            // Mostrar loading
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').style.display = 'none';
            document.getElementById('btnAnalisar').disabled = true;

            try {
                const response = await fetch(`${API_BASE_URL}/analyze`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        conteudo: conteudo,
                        url_edital: urlEdital || null,
                        banca: banca || null
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    exibirResultados(data);
                } else {
                    throw new Error(data.detail || 'Erro na an√°lise');
                }

            } catch (error) {
                console.error('Erro:', error);
                alert(`Erro na an√°lise: ${error.message}`);
            } finally {
                // Esconder loading
                document.getElementById('loading').style.display = 'none';
                document.getElementById('btnAnalisar').disabled = false;
            }
        }

        function exibirResultados(data) {
            const resultsContent = document.getElementById('resultsContent');
            const resultado = data.resultado;

            let html = `
                <div class="result-card">
                    <h3>üìã Informa√ß√µes B√°sicas</h3>
                    <div class="result-item">
                        <span class="result-label">Status:</span>
                        <span class="result-value status-success">${data.status}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Tempo de Processamento:</span>
                        <span class="result-value">${data.tempo_processamento.toFixed(2)}s</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Tipo de Documento:</span>
                        <span class="result-value">${resultado.analise_basica?.tipo_documento || 'N/A'}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Banca Organizadora:</span>
                        <span class="result-value">${resultado.analise_basica?.banca_organizadora || 'N/A'}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">√ìrg√£o Respons√°vel:</span>
                        <span class="result-value">${resultado.analise_basica?.orgao_responsavel || 'N/A'}</span>
                    </div>
                </div>

                <div class="result-card">
                    <h3>üìä Estat√≠sticas</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">${resultado.analise_basica?.numero_secoes || 0}</div>
                            <div class="stat-label">Se√ß√µes</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${resultado.analise_basica?.palavras_totais || 0}</div>
                            <div class="stat-label">Palavras</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${resultado.informacoes_extraidas?.disciplinas?.length || 0}</div>
                            <div class="stat-label">Disciplinas</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${resultado.informacoes_extraidas?.datas?.length || 0}</div>
                            <div class="stat-label">Datas</div>
                        </div>
                    </div>
                </div>
            `;

            // Informa√ß√µes extra√≠das
            const info = resultado.informacoes_extraidas || {};
            
            if (info.cargos && info.cargos.length > 0) {
                html += `
                    <div class="result-card">
                        <h3>üë• Cargos Identificados</h3>
                        ${info.cargos.map(cargo => `
                            <div class="result-item">
                                <span class="result-label">${cargo.cargo}</span>
                                <span class="result-value">${cargo.contexto}</span>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            if (info.vagas && info.vagas.length > 0) {
                html += `
                    <div class="result-card">
                        <h3>üìà Vagas</h3>
                        ${info.vagas.map(vaga => `
                            <div class="result-item">
                                <span class="result-label">N√∫mero de Vagas:</span>
                                <span class="result-value">${vaga.numero_vagas}</span>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            if (info.disciplinas && info.disciplinas.length > 0) {
                html += `
                    <div class="result-card">
                        <h3>üìö Disciplinas</h3>
                        ${info.disciplinas.map(disc => `
                            <div class="result-item">
                                <span class="result-label">${disc.disciplina}</span>
                                <span class="result-value">${disc.tipo}</span>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            if (info.datas && info.datas.length > 0) {
                html += `
                    <div class="result-card">
                        <h3>üìÖ Datas Importantes</h3>
                        ${info.datas.map(data => `
                            <div class="result-item">
                                <span class="result-label">${data.tipo}:</span>
                                <span class="result-value">${data.data}</span>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            if (info.valores && info.valores.length > 0) {
                html += `
                    <div class="result-card">
                        <h3>üí∞ Valores Monet√°rios</h3>
                        ${info.valores.map(valor => `
                            <div class="result-item">
                                <span class="result-label">${valor.tipo}:</span>
                                <span class="result-value">${valor.valor_formatado}</span>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            if (resultado.resumo_executivo) {
                html += `
                    <div class="result-card">
                        <h3>üìù Resumo Executivo</h3>
                        <p style="line-height: 1.6; color: #2c3e50;">${resultado.resumo_executivo}</p>
                    </div>
                `;
            }

            if (resultado.analise_relevancia) {
                const relevancia = resultado.analise_relevancia;
                html += `
                    <div class="result-card">
                        <h3>‚≠ê An√°lise de Relev√¢ncia</h3>
                        <div class="result-item">
                            <span class="result-label">Score:</span>
                            <span class="result-value">${relevancia.score_relevancia}</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Classifica√ß√£o:</span>
                            <span class="result-value">${relevancia.classificacao}</span>
                        </div>
                    </div>
                `;
            }

            resultsContent.innerHTML = html;
            document.getElementById('results').style.display = 'block';
        }

        async function loadSampleEdital() {
            try {
                const response = await fetch(`${API_BASE_URL}/analyze/sample`);
                const data = await response.json();
                
                if (response.ok) {
                    // Carregar o edital de exemplo no textarea
                    const editalExemplo = `
EDITAL N¬∫ 1 ‚Äì DGP/DPF, DE 15 DE JUNHO DE 2023
CONCURSO P√öBLICO PARA O PROVIMENTO DE VAGAS NO CARGO DE AGENTE DE POL√çCIA FEDERAL

O DIRETOR-GERAL DA POL√çCIA FEDERAL, no uso de suas atribui√ß√µes, torna p√∫blica a realiza√ß√£o de concurso p√∫blico para o provimento de 1.500 vagas no cargo de Agente de Pol√≠cia Federal.

1 DAS DISPOSI√á√ïES PRELIMINARES
1.1 O concurso p√∫blico ser√° regido por este edital e executado pelo Centro Brasileiro de Pesquisa em Avalia√ß√£o e Sele√ß√£o e de Promo√ß√£o de Eventos (Cebraspe).
1.2 O cargo de Agente de Pol√≠cia Federal exige n√≠vel superior em qualquer √°rea de forma√ß√£o.
1.3 A remunera√ß√£o inicial √© de R$ 12.522,50.

2 DAS INSCRI√á√ïES
2.1 As inscri√ß√µes poder√£o ser realizadas no per√≠odo de 20/07/2023 a 02/08/2023.
2.2 A taxa de inscri√ß√£o √© de R$ 180,00.

3 DAS ETAPAS DO CONCURSO
3.1 Prova Objetiva e Discursiva: 19/09/2023.
3.2 Exame de Aptid√£o F√≠sica.
3.3 Avalia√ß√£o M√©dica.
3.4 Avalia√ß√£o Psicol√≥gica.

4 DAS DISCIPLINAS
Ser√£o cobradas as seguintes disciplinas: L√≠ngua Portuguesa, No√ß√µes de Direito Administrativo, No√ß√µes de Direito Constitucional, Racioc√≠nio L√≥gico, Inform√°tica, Contabilidade Geral.
                    `;
                    
                    document.getElementById('conteudoEdital').value = editalExemplo.trim();
                    document.getElementById('banca').value = 'CESPE/CEBRASPE';
                    document.getElementById('urlEdital').value = 'https://exemplo.com/edital-pf';
                    
                    alert('Edital de exemplo carregado! Clique em "Analisar Edital" para testar.');
                } else {
                    throw new Error('Erro ao carregar exemplo');
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao carregar edital de exemplo. Verifique se o servidor est√° rodando.');
            }
        }

        function clearForm() {
            document.getElementById('conteudoEdital').value = '';
            document.getElementById('urlEdital').value = '';
            document.getElementById('banca').value = '';
            document.getElementById('results').style.display = 'none';
        }

        // Verificar se o servidor est√° rodando ao carregar a p√°gina
        window.addEventListener('load', async () => {
            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                if (response.ok) {
                    console.log('‚úÖ Servidor conectado com sucesso!');
                } else {
                    console.warn('‚ö†Ô∏è Servidor n√£o est√° respondendo corretamente');
                }
            } catch (error) {
                console.error('‚ùå Erro ao conectar com o servidor:', error);
                alert('‚ö†Ô∏è N√£o foi poss√≠vel conectar com o servidor. Verifique se est√° rodando em http://localhost:8002');
            }
        });
    </script>
</body>
</html>
