# Cebraspe Parser OCR - Documenta√ß√£o T√©cnica

## 1. Objetivo e Contexto

### Objetivo
O **Cebraspe Parser OCR** √© um sistema automatizado para extra√ß√£o de texto e metadados de documentos PDF da banca Cebraspe, com suporte a reconhecimento √≥ptico de caracteres (OCR) para PDFs baseados em imagem. O sistema transforma PDFs em texto pesquis√°vel com fallback para OCR quando necess√°rio.

### Contexto de Neg√≥cio
- **Usu√°rio**: M√≥dulo de IA e busca (downstream)
- **Valor**: Texto limpo e metadados para extra√ß√£o de conte√∫do program√°tico e indexa√ß√£o
- **Dom√≠nio**: Documentos p√∫blicos da Cebraspe (editais, provas, gabaritos, resultados)
- **Depend√™ncia**: CEB-001 (Crawler Cebraspe) para fornecimento de PDFs

### Funcionalidades Principais
- üîç **An√°lise de PDF**: Detec√ß√£o autom√°tica de tipo (texto/imagem/misto)
- üìÑ **Extra√ß√£o de Texto**: Extra√ß√£o nativa para PDFs com texto
- üëÅÔ∏è **OCR Engine**: Reconhecimento √≥ptico para PDFs baseados em imagem
- üè∑Ô∏è **Classifica√ß√£o**: Identifica√ß√£o autom√°tica de tipo de documento
- üßπ **Normaliza√ß√£o**: Limpeza e normaliza√ß√£o de texto extra√≠do
- üìä **Metadados**: Extra√ß√£o e cataloga√ß√£o de metadados
- ‚úÖ **Controle de Qualidade**: Valida√ß√£o de qualidade do texto extra√≠do

## 2. Como Rodar (Passo a Passo Conceitual)

### Pr√©-requisitos
- Python 3.8+
- Tesseract OCR instalado
- Acesso aos PDFs catalogados pelo CEB-001
- Espa√ßo em disco adequado

### Instala√ß√£o
```bash
# 1. Extrair o scaffold
unzip CODE_SCAFFOLD_CEB-002.zip
cd cebraspe-parser

# 2. Instalar depend√™ncias
pip install -r requirements.txt

# 3. Configurar Tesseract OCR
make setup-ocr

# 4. Configurar ambiente
cp .env.example .env
# Editar .env com suas configura√ß√µes
```

### Execu√ß√£o B√°sica
```bash
# Execu√ß√£o simples
python src/main.py

# Modo debug
python src/main.py --debug

# Modo dry-run (sem processamento real)
python src/main.py --dry-run

# Processar arquivos espec√≠ficos
python src/main.py --input ./data/input --output ./data/output
```

### Fluxo de Execu√ß√£o Conceitual

1. **Inicializa√ß√£o**
   - Carregamento de configura√ß√µes
   - Setup de logging
   - Verifica√ß√£o de depend√™ncias (Tesseract)

2. **An√°lise de PDFs**
   - Escaneamento de arquivos de entrada
   - An√°lise de tipo de PDF (texto/imagem/misto)
   - Extra√ß√£o de metadados b√°sicos
   - C√°lculo de score de qualidade

3. **Extra√ß√£o de Texto**
   - **PDFs com texto nativo**: Extra√ß√£o direta
   - **PDFs baseados em imagem**: Convers√£o para OCR
   - **PDFs mistos**: Estrat√©gia h√≠brida

4. **Processamento OCR** (quando necess√°rio)
   - Convers√£o de PDF para imagens
   - Pr√©-processamento de imagens
   - Reconhecimento √≥ptico com Tesseract
   - P√≥s-processamento de texto

5. **Classifica√ß√£o de Documentos**
   - Identifica√ß√£o de tipo (edital/prova/gabarito)
   - Extra√ß√£o de metadados espec√≠ficos
   - Valida√ß√£o de classifica√ß√£o

6. **Normaliza√ß√£o de Texto**
   - Limpeza de erros de OCR
   - Normaliza√ß√£o de charset UTF-8
   - Preserva√ß√£o de formata√ß√£o
   - Valida√ß√£o de qualidade

7. **Gera√ß√£o de Sa√≠da**
   - Salvamento de arquivos .txt
   - Gera√ß√£o de metadados JSON
   - Backup de arquivos processados
   - Relat√≥rio de processamento

8. **Finaliza√ß√£o**
   - Estat√≠sticas de processamento
   - Logs de qualidade
   - Limpeza de arquivos tempor√°rios

## 3. APIs (Se Houver) com Exemplos

### Configura√ß√£o Program√°tica
```python
from src.config.settings import ProcessingConfig
from src.parser.pdf_analyzer import PDFAnalyzer
from src.parser.text_extractor import TextExtractor
from src.parser.ocr_engine import OCREngine

# Configura√ß√£o customizada
config = ProcessingConfig(
    ocr_engine="tesseract",
    ocr_language="por",
    ocr_dpi=300,
    min_confidence=0.7,
    output_encoding="utf-8"
)

# Uso dos componentes
analyzer = PDFAnalyzer(config)
text_extractor = TextExtractor(config)
ocr_engine = OCREngine(config)

# An√°lise de PDF
analysis = analyzer.analyze_pdf("documento.pdf")

# Extra√ß√£o baseada no tipo
if analysis.pdf_type == PDFType.TEXT_BASED:
    extracted_text = text_extractor.extract_text("documento.pdf")
else:
    extracted_text = ocr_engine.extract_text_ocr("documento.pdf")
```

### Processamento de Lote
```python
from src.storage.file_manager import FileManager
from src.processing.normalizer import TextNormalizer

# Gerenciamento de arquivos
file_manager = FileManager(config)
normalizer = TextNormalizer(config)

# Processar lote de arquivos
pdf_files = file_manager.get_input_files()

for pdf_file in pdf_files:
    # An√°lise
    analysis = analyzer.analyze_pdf(pdf_file)
    
    # Extra√ß√£o
    if analysis.pdf_type == PDFType.TEXT_BASED:
        extracted_text = text_extractor.extract_text(pdf_file)
    else:
        extracted_text = ocr_engine.extract_text_ocr(pdf_file)
    
    # Normaliza√ß√£o
    normalized_text = normalizer.normalize_text(extracted_text.extracted_text)
    
    # Salvamento
    text_file = file_manager.save_extracted_text(extracted_text, pdf_file)
    metadata_file = file_manager.save_metadata(metadata, pdf_file)
```

### Modelos de Dados
```python
from src.models.document import PDFAnalysis, ExtractedText, DocumentMetadata

# An√°lise de PDF
analysis = PDFAnalysis.create(
    file_path="documento.pdf",
    file_size=2048576,
    page_count=45,
    pdf_type=PDFType.TEXT_BASED,
    has_text=True,
    has_images=False,
    image_count=0,
    text_quality_score=0.95
)

# Texto extra√≠do
extracted_text = ExtractedText.create(
    original_file="documento.pdf",
    extracted_text="Conte√∫do do documento...",
    page_count=45,
    extraction_method="native",
    confidence_score=0.98,
    processing_time=2.5
)

# Metadados do documento
metadata = DocumentMetadata.create(
    original_file="documento.pdf",
    document_class=DocumentClass.EDITAL,
    title="Edital Concurso 2024",
    year=2024,
    organization="Cebraspe",
    extracted_text_file="./output/edital_2024.txt",
    metadata_file="./output/edital_2024.json",
    quality_score=0.95
)
```

## 4. Vari√°veis de Ambiente e Logs

### Vari√°veis de Ambiente (.env)
```bash
# OCR Settings
OCR_ENGINE=tesseract
OCR_LANGUAGE=por
OCR_DPI=300
OCR_PSM=6
TESSERACT_CMD=/usr/bin/tesseract

# Text Processing
MIN_CONFIDENCE=0.7
MAX_PROCESSING_TIME=300
PRESERVE_FORMATTING=false

# Output Settings
OUTPUT_ENCODING=utf-8
OUTPUT_DIR=./data/output
INPUT_DIR=./data/input

# Performance
MAX_CONCURRENT_JOBS=3
BATCH_SIZE=10

# Quality Control
ENABLE_QUALITY_CHECK=true
MIN_TEXT_LENGTH=100
MAX_FILE_SIZE_MB=50

# Logging
LOG_LEVEL=INFO
LOG_FORMAT=json
LOG_FILE=./logs/parser.log

# Development
DEBUG=false
DRY_RUN=false
VERBOSE=false
```

### Estrutura de Logs
```json
{
  "timestamp": "2024-01-15T10:30:00Z",
  "level": "INFO",
  "logger": "src.parser.pdf_analyzer",
  "message": "PDF analisado com sucesso",
  "module": "pdf_analyzer",
  "function": "analyze_pdf",
  "line": 45,
  "extra_fields": {
    "file_path": "documento.pdf",
    "pdf_type": "text_based",
    "quality_score": 0.95,
    "processing_time": 1.2
  }
}
```

### N√≠veis de Log
- **DEBUG**: Informa√ß√µes detalhadas para desenvolvimento
- **INFO**: Informa√ß√µes gerais sobre o progresso
- **WARNING**: Situa√ß√µes que podem causar problemas
- **ERROR**: Erros que n√£o impedem a execu√ß√£o
- **CRITICAL**: Erros que impedem a execu√ß√£o

### Arquivos de Log
- `logs/parser.log`: Log principal em formato JSON
- Console: Logs em formato leg√≠vel para desenvolvimento

## 5. Limita√ß√µes e Pr√≥ximos Passos

### Limita√ß√µes Atuais

#### Funcionais
- **OCR**: Limitado ao Tesseract, precis√£o dependente da qualidade da imagem
- **Idiomas**: Suporte principal para portugu√™s
- **Tipos de PDF**: Foco em documentos da Cebraspe
- **Formata√ß√£o**: Preserva√ß√£o limitada de formata√ß√£o complexa

#### T√©cnicas
- **Performance**: OCR pode ser lento para PDFs grandes
- **Mem√≥ria**: Processamento de imagens consome mem√≥ria
- **Qualidade**: Dependente da qualidade dos PDFs de entrada
- **Escalabilidade**: Processamento sequencial, n√£o paralelo

#### Operacionais
- **Depend√™ncias**: Requer Tesseract instalado
- **Recursos**: Consome CPU e mem√≥ria durante OCR
- **Armazenamento**: Gera arquivos de texto e metadados
- **Monitoramento**: Logs b√°sicos, sem m√©tricas avan√ßadas

### Pr√≥ximos Passos

#### Curto Prazo (Sprint 2)
1. **Implementa√ß√£o Completa**
   - Finalizar l√≥gica de an√°lise de PDF
   - Implementar extra√ß√£o de texto nativo
   - Completar engine de OCR
   - Finalizar classifica√ß√£o de documentos

2. **Testes e Qualidade**
   - Implementar testes unit√°rios e integra√ß√£o
   - Configurar CI/CD
   - Adicionar valida√ß√£o de qualidade
   - Testes com PDFs reais

3. **Documenta√ß√£o**
   - Documentar APIs internas
   - Criar guias de troubleshooting
   - Adicionar exemplos de uso

#### M√©dio Prazo (Sprint 3-4)
1. **Melhorias de Performance**
   - Otimiza√ß√£o de algoritmos OCR
   - Processamento paralelo
   - Cache de resultados
   - Compress√£o de imagens

2. **Robustez**
   - Tratamento de PDFs corrompidos
   - Recupera√ß√£o de falhas
   - Valida√ß√£o de qualidade
   - Sistema de retry

3. **Monitoramento**
   - M√©tricas de performance
   - Alertas autom√°ticos
   - Dashboard de status
   - An√°lise de qualidade

#### Longo Prazo (Futuro)
1. **Escalabilidade**
   - Processamento distribu√≠do
   - Armazenamento em nuvem
   - APIs REST para consulta
   - Processamento em lote

2. **Intelig√™ncia**
   - ML para classifica√ß√£o
   - Detec√ß√£o autom√°tica de layout
   - Corre√ß√£o autom√°tica de erros
   - An√°lise de conte√∫do

3. **Integra√ß√£o**
   - APIs para sistemas downstream
   - Webhooks para notifica√ß√µes
   - Integra√ß√£o com IA
   - An√°lise sem√¢ntica

### Depend√™ncias Externas
- **Tesseract OCR**: Engine de OCR (deve estar instalado)
- **PDFs de entrada**: Fornecidos pelo CEB-001
- **Sistema**: Recursos computacionais adequados
- **Rede**: Para download de depend√™ncias

### Riscos Identificados
1. **Qualidade dos PDFs**: PDFs de baixa qualidade afetam OCR
2. **Performance**: OCR pode ser lento para grandes volumes
3. **Depend√™ncias**: Tesseract deve estar configurado corretamente
4. **Mem√≥ria**: Processamento de imagens consome recursos

### Crit√©rios de Sucesso
- ‚úÖ Taxa de sucesso OCR ‚â•95%
- ‚úÖ Tempo razo√°vel por documento
- ‚úÖ Texto extra√≠do com qualidade adequada
- ‚úÖ Metadados extra√≠dos corretamente
- ‚úÖ Encoding UTF-8 v√°lido
- ‚úÖ Logs estruturados e informativos
- ‚úÖ Cobertura de testes >85%
- ‚úÖ Documenta√ß√£o completa e atualizada

### Configura√ß√£o Recomendada
- **CPU**: 4+ cores para processamento paralelo
- **RAM**: 8GB+ para PDFs grandes
- **Disco**: SSD para melhor performance
- **Tesseract**: Vers√£o 4.0+ com suporte a portugu√™s









